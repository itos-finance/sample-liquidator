from lib.Utils import get_abi
import pytest

import pytest_asyncio

from web3 import (
    EthereumTesterProvider,
    Web3,
)
from web3.eth import (
    AsyncEth,
)
from web3.providers.eth_tester.main import (
    AsyncEthereumTesterProvider,
)


@pytest.fixture
def tester_provider():
    return EthereumTesterProvider()


@pytest.fixture
def eth_tester(tester_provider):
    return tester_provider.ethereum_tester


@pytest.fixture
def w3(tester_provider):
    return Web3(tester_provider)


@pytest.fixture
def pm_contract(eth_tester, w3):

    deploy_address = eth_tester.get_accounts()[0]

    pm_abi = get_abi("../abis/PositionManagerFacet.json")
    bytecode = """608060405234801561001057600080fd5b5061508a806100206000396000f3fe608060405234801561001057600080fd5b50600436106100775760003560e01c80627440d61461007c5780633e3bf7d7146100a55780635aef3d45146100ba5780639f1df9ee146100da578063aa472a18146100ed578063b10658b314610100578063c3a2363214610113578063dfe8f67114610134575b600080fd5b61008f61008a3660046141f4565b610147565b60405161009c91906142b5565b60405180910390f35b6100b86100b33660046143f3565b61039a565b005b6100cd6100c83660046141f4565b610944565b60405161009c919061447e565b6100b86100e836600461453b565b610964565b6100b86100fb3660046145cc565b610d9e565b6100b861010e36600461461a565b611002565b610126610121366004614657565b6111ee565b60405190815260200161009c565b6100b86101423660046141f4565b6116a8565b6060600061016d6101566116f2565b600085815260019190910160205260409020611716565b9050600081516001600160401b0381111561018a5761018a6146bf565b6040519080825280602002602001820160405280156101fe57816020015b6101eb6040805160c08101909152806000815260200160006001600160a01b03168152602001606081526020016060815260200160608152602001606081525090565b8152602001906001900390816101a85790505b50905060005b82518110156103925760006102176116f2565b600201600085848151811061022e5761022e6146d5565b602002602001015181526020019081526020016000206040518060a00160405290816000820160009054906101000a900460ff1660018111156102735761027361420d565b60018111156102845761028461420d565b81528154602090910190610100900460ff1660018111156102a7576102a761420d565b60018111156102b8576102b861420d565b81526001820154602082015260028201546001600160a01b03908116604080840191909152600390930154811660609283015290830151838301519251631da2357f60e11b81529394501691633b446afe9161031a9160040190815260200190565b6000604051808303816000875af1158015610339573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610361919081019061484b565b838381518110610373576103736146d5565b602002602001018190525050808061038a9061495b565b915050610204565b509392505050565b6103a261172a565b6001015462010000900460ff16156103d55760405162461bcd60e51b81526004016103cc90614974565b60405180910390fd5b6103dd61172a565b546001146103fd5760405162461bcd60e51b81526004016103cc906149a1565b600261040761172a565b55610410614132565b600061041a6116f2565b600201600087876000818110610432576104326146d5565b602090810292909201358352508101919091526040908101600020815160a081019092528054829060ff16600181111561046e5761046e61420d565b600181111561047f5761047f61420d565b81528154602090910190610100900460ff1660018111156104a2576104a261420d565b60018111156104b3576104b361420d565b81526001820154602082015260028201546001600160a01b0390811660408301526003909201548216606090910152608082015116835290506104f46116f2565b60030160008787600081811061050c5761050c6146d5565b602090810292909201358352508181019290925260400160009081205460ff1691840182905283519091610549916001600160a01b03169061174e565b905080891461056b5760405163af535a8560e01b815260040160405180910390fd5b604083018690528361057e8760026149c5565b1461059c5760405163aaad13f760e01b815260040160405180910390fd5b60006105a78a610944565b90506105b281611776565b606086015260808501526105c461172a565b6005015481606001511080156105ea57506105e86105e06118ee565b600c01611912565b155b1561060857604051635e6797f960e01b815260040160405180910390fd5b886001600160a01b03166314da6de7338888600081811061062b5761062b6146d5565b905060200281019061063d91906149d8565b6040518463ffffffff1660e01b815260040161065b93929190614a47565b600060405180830381600087803b15801561067557600080fd5b505af1158015610689573d6000803e3d6000fd5b5050505061069561191c565b60005b84604001518110156107bb5773__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__63168adda9868b8b858181106106d1576106d16146d5565b905060200201356040518363ffffffff1660e01b81526004016106f5929190614a6c565b60006040518083038186803b15801561070d57600080fd5b505af4158015610721573d6000803e3d6000fd5b50505050600061077b868d8c8c8681811061073e5761073e6146d5565b905060200201358e8c8c88600161075591906149c5565b818110610764576107646146d5565b905060200281019061077691906149d8565b611941565b90506107906107886118ee565b600601611ed2565b505060c088015260a087015280156107a857506107bb565b50806107b38161495b565b915050610698565b506107c461172a565b600801548460c001516107d791906149c5565b846080015111156107fb5760405163f67382cf60e01b815260040160405180910390fd5b600061080685611f13565b90508460e001518111801561082357506108216105e06118ee565b155b1561084157604051632b5df01d60e21b815260040160405180910390fd5b610881858b8d848b8b8b60400151600161085b91906149c5565b81811061086a5761086a6146d5565b905060200281019061087c91906149d8565b611f94565b6108a260405180606001604052806032815260200161504c603291396122d9565b6108ab8b61231f565b6108da6040518060400160405280600e81526020016d1a19585b1d1a0818da1958dad95960921b8152506122d9565b6108e2612554565b845160405133916001600160a01b0316907f0a82ab941c2b82f66fe2177948df808a1071943c940c84177f0bdb967eeb515d90610924908f908e908e90614b52565b60405180910390a35050505050600161093b61172a565b55505050505050565b61094c6141a8565b6109558261257a565b905061095f61191c565b919050565b61096c61172a565b6001015462010000900460ff16156109965760405162461bcd60e51b81526004016103cc90614974565b61099e61172a565b546001146109be5760405162461bcd60e51b81526004016103cc906149a1565b60026109c861172a565b556109d1614132565b604081018490523381526109e36116f2565b6003016000868660008181106109fb576109fb6146d5565b602090810292909201358352508181019290925260400160009081205460ff1691830182905290610a2d90339061174e565b60408301519091508390610a429060026149c5565b14610a605760405163aaad13f760e01b815260040160405180910390fd5b866001600160a01b03166314da6de73386866000818110610a8357610a836146d5565b9050602002810190610a9591906149d8565b6040518463ffffffff1660e01b8152600401610ab393929190614a47565b600060405180830381600087803b158015610acd57600080fd5b505af1158015610ae1573d6000803e3d6000fd5b5050505060005b8260400151811015610c5a576000878783818110610b0857610b086146d5565b90506020020135905073__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__63168adda985836040518363ffffffff1660e01b8152600401610b4a929190614a6c565b60006040518083038186803b158015610b6257600080fd5b505af4158015610b76573d6000803e3d6000fd5b5050505073__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__63757987fa610b9c6116f2565b60008481526002919091016020526040902085848d8b8b610bbe8a60016149c5565b818110610bcd57610bcd6146d5565b9050602002810190610bdf91906149d8565b6040518763ffffffff1660e01b8152600401610c0096959493929190614b93565b600060405180830381865af4158015610c1d573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610c45919081019061484b565b50508080610c529061495b565b915050610ae8565b506000610c70610c686118ee565b600601612872565b90506000610c87610c7f6118ee565b600901612872565b9050886001600160a01b03166379506b7a8360000151836000015184608001516000808c8c8c604001516001610cbd91906149c5565b818110610ccc57610ccc6146d5565b9050602002810190610cde91906149d8565b6040518863ffffffff1660e01b8152600401610d009796959493929190614c1e565b600060405180830381600087803b158015610d1a57600080fd5b505af1158015610d2e573d6000803e3d6000fd5b50505050610d3b8361231f565b610d43612554565b336001600160a01b03167f8ea6b76a8f2f5fd1c4fa74d2bd033ccc74cd8adda6d79eca8686f924ccdcd70d848a8a604051610d8093929190614b52565b60405180910390a2505050506001610d9661172a565b555050505050565b610da661172a565b6001015462010000900460ff1615610dd05760405162461bcd60e51b81526004016103cc90614974565b610dd861172a565b54600114610df85760405162461bcd60e51b81526004016103cc906149a1565b6002610e0261172a565b556000610e0d6116f2565b6000858152600291909101602052604090819020815160a081019092528054829060ff166001811115610e4257610e4261420d565b6001811115610e5357610e5361420d565b81528154602090910190610100900460ff166001811115610e7657610e7661420d565b6001811115610e8757610e8761420d565b81526001820154602082015260028201546001600160a01b03908116604083015260039092015490911660609091015290506000610ee3610ec66116f2565b60008781526003919091016020526040902054339060ff1661174e565b90506002600160801b03196001600160801b03841601610f25576000610f09338661174e565b9050610f16868383612acd565b610f1f8161231f565b50610fa4565b81606001516001600160a01b031663c5d94ec383604001513387876040518563ffffffff1660e01b8152600401610f5f9493929190614c90565b6020604051808303816000875af1158015610f7e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610fa29190614cc0565b505b610fad8161231f565b604080518681526001600160801b038516602082015233917f1cd1654a743ca45abf9b752e61cab3947f5ea1d944bb3a9f1ebc5b2a384bdef4910160405180910390a250506001610ffc61172a565b55505050565b61100a61172a565b6001015462010000900460ff16156110345760405162461bcd60e51b81526004016103cc90614974565b61103c61172a565b5460011461105c5760405162461bcd60e51b81526004016103cc906149a1565b600261106661172a565b5560006110716116f2565b6000848152600391909101602052604081205460ff169150611093338361174e565b905060006110a1338561174e565b905060006110ad6116f2565b60008481526001919091016020526040902090506110cb8187612ae6565b6110e857604051636ec9be1160e01b815260040160405180910390fd5b6110f061172a565b600401546111166110ff6116f2565b600085815260019190910160205260409020611912565b10611134576040516348a2ce5d60e01b815260040160405180910390fd5b611158866111406116f2565b60008581526001919091016020526040902090612af2565b50846111626116f2565b600088815260039190910160205260409020805460ff191660ff9290921691909117905561118f8361231f565b6111988261231f565b604080518781526020810185905290810183905233907fdf2148bb18fed388514bb5adf1332a4378596231196364ac58e80697d98c72df9060600160405180910390a25050505060016111e961172a565b555050565b6000336111f96116f2565b6001600160a01b0382166000908152600591909101602052604090205460ff16801561124a575061122861172a565b6001600160a01b0382166000908152600291909101602052604090205460ff16155b6112895760405162461bcd60e51b815260206004820152601060248201526f24b73b30b634b210383937b23ab1b2b960811b60448201526064016103cc565b61129161172a565b6001015460ff161580156112b757506112a861172a565b6001015462010000900460ff16155b6112f75760405162461bcd60e51b8152602060048201526011602482015270125b9cdd185b1b081a5cc81a185b1d1959607a1b60448201526064016103cc565b600061130c6001600160a01b0387168561174e565b905061131661172a565b6004015461133c6113256116f2565b600084815260019190910160205260409020611912565b1015801561136f575061134d6116f2565b6001600160a01b0387166000908152600591909101602052604090205460ff16155b1561138d576040516348a2ce5d60e01b815260040160405180910390fd5b6113956116f2565b6004015492506113a36116f2565b60040180549060006113b48361495b565b91905055506113dd836113c56116f2565b60008481526001919091016020526040902090612af2565b506040518060a001604052808960018111156113fb576113fb61420d565b81526020018860018111156114125761141261420d565b8152602081018790523360408201526001600160a01b0388166060909101526114396116f2565b60008581526002919091016020526040902081518154829060ff1916600183818111156114685761146861420d565b021790555060208201518154829061ff0019166101008360018111156114905761149061420d565b02179055506040820151600182015560608201516002820180546001600160a01b03199081166001600160a01b0393841617909155608090930151600390920180549093169116179055836114e36116f2565b600085815260039190910160205260409020805460ff191660ff92909216919091179055600187600181111561151b5761151b61420d565b14801561153057506001600160a01b03861615155b1561164557604051631da2357f60e11b8152600481018690526000903390633b446afe906024016000604051808303816000875af1158015611576573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261159e919081019061484b565b905060006115be8260400151836060015184608001518560a00151612afe565b5050925050506115cc61172a565b600a015481101561164257604051631363126760e31b815260048101849052602481018690523090639b189338906044016020604051808303816000875af115801561161c573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906116409190614cd9565b505b50505b61164e8161231f565b6040805160ff86168152602081018590529081018690526001600160a01b038716907f2e0fdb350777af80c22496097f1cf841dbf6a793ec8ea38c2443fb8c425c8cb89060600160405180910390a2505095945050505050565b6116b061172a565b546001146116d05760405162461bcd60e51b81526004016103cc906149a1565b60026116da61172a565b556116e48161231f565b60016116ee61172a565b5550565b7f8b01cbfd55603d7f2ef7a7db9457e9fad27767743e32f6ac85149b4c8fc953f190565b6060600061172383612cb0565b9392505050565b7feba66862cb53efa83d6086bdc81e3573d87b3eb910808c2b974f9369a3b6de5090565b600061176d60ff60a01b60a084901b166001600160a01b0385166149c5565b90505b92915050565b60008061178161172a565b600501548360600151101561179b57506000905080611842565b6117a361172a565b600501548360600151101580156117bc57506020830151155b156117da5760006117d08460000151612d0c565b9092509050611842565b600160801b8360600151106118255760006117f88460200151612d0c565b846020015161180791906149c5565b8451909150811115611817575082515b602084015192509050611842565b61183c836060015184602001518560000151612d38565b90925090505b60808301515160008190036118575750915091565b60006118616118ee565b600c01905060005b828110156118e65761187961172a565b600501548661010001518281518110611894576118946146d5565b602002602001015111156118d4576118d2866080015182815181106118bb576118bb6146d5565b602002602001015183612de890919063ffffffff16565b505b806118de8161495b565b915050611869565b505050915091565b7ff8961e812f9c0e13028a5288a8f49316de70bf8099e614ce7e9d11fae8c223c390565b6000611770825490565b61192c6119276118ee565b612dfd565b61193f6119376118ee565b600301612dfd565b565b60008061194c6116f2565b6000878152600291909101602052604090819020815160a081019092528054829060ff1660018111156119815761198161420d565b60018111156119925761199261420d565b81528154602090910190610100900460ff1660018111156119b5576119b561420d565b60018111156119c6576119c661420d565b81526001820154602082015260028201546001600160a01b03908116604080840191909152600390930154811660609283015290830151838301519251631da2357f60e11b815260048101939093529293506000921690633b446afe906024016000604051808303816000875af1158015611a45573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052611a6d919081019061484b565b9050611a8b8160400151826060015183608001518460a00151612afe565b15156101408e018190526101208e019390935250506101008b0191909152611bd7576000611ab76118ee565b600c019050600080836040015151905060005b81811015611b2257611b0285604001518281518110611aeb57611aeb6146d5565b602002602001015185612e5e90919063ffffffff16565b15611b105760019250611b22565b80611b1a8161495b565b915050611aca565b5081611b4157604051631ee251b160e31b815260040160405180910390fd5b604051633abcc3fd60e11b815273__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__9063757987fa90611b829088908f908f908f908f908f90600401614cf6565b600060405180830381865af4158015611b9f573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052611bc7919081019061484b565b9350600095505050505050611ec8565b610120890151158015611bf257508860e00151896101000151115b15611c035761010089015160e08a01525b600089608001518a60c0015111611c2d578960c001518a60800151611c289190614d71565b611c30565b60005b9050808a6101200151118015611c465750600081115b15611e39576000611c5c828c6101200151612e80565b90506001600160801b03811615611da457600084606001516001600160a01b031663c5d94ec38660400151600080866040518563ffffffff1660e01b8152600401611caa9493929190614c90565b6020604051808303816000875af1158015611cc9573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611ced9190614cc0565b905084606001516001600160a01b031663ea962d29611d0a6116f2565b6002016000848152602001908152602001600020600101548b8b8b6040518563ffffffff1660e01b8152600401611d449493929190614d84565b6000604051808303816000875af1158015611d63573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052611d8b919081019061484b565b9350611d9684612f39565b600195505050505050611ec8565b604051633abcc3fd60e11b815273__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__9063757987fa90611de59087908e908e908e908e908e90600401614cf6565b600060405180830381865af4158015611e02573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052611e2a919081019061484b565b92506001945050505050611ec8565b604051633abcc3fd60e11b815273__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__9063757987fa90611e7a9086908d908d908d908d908d90600401614cf6565b600060405180830381865af4158015611e97573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052611ebf919081019061484b565b50600093505050505b9695505050505050565b600080600060606000611ee486612872565b9050611f028160000151826020015183604001518460600151612afe565b509299919850965090945092505050565b6000808260c001518360a0015111611f2c576000611f40565b8260c001518360a00151611f409190614d71565b905060008360800151846060015111611f5a576000611f6e565b83608001518460600151611f6e9190614d71565b905080821115611f8a57611f828183614d71565b949350505050565b5060009392505050565b6040516309466d5f60e11b81526004810185905260009073__$5d1cfa4a5a9e1bdbec6a88f31f3ca5fb7b$__9063128cdabe90602401602060405180830381865af4158015611fe7573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061200b9190614cd9565b905060006120198286612f58565b90506000806120316120296118ee565b600901612f70565b915091506120aa846001600160a01b03166370a082318b6040518263ffffffff1660e01b81526004016120649190614daf565b602060405180830381865afa158015612081573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906120a59190614cc0565b6130d1565b6040516370a0823160e01b81526001600160a01b038516906370a08231906120d6903090600401614daf565b602060405180830381865afa1580156120f3573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906121179190614cc0565b6101608b015261212682613116565b6101808b01526000612139610c686118ee565b8051604051633ca835bd60e11b81529192506001600160a01b038c16916379506b7a9161217491879087908b908b908f908f90600401614c1e565b600060405180830381600087803b15801561218e57600080fd5b505af11580156121a2573d6000803e3d6000fd5b50506040516370a0823160e01b81526001600160a01b03881693506370a0823192506121d391503090600401614daf565b602060405180830381865afa1580156121f0573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906122149190614cc0565b838b610160015161222591906149c5565b1461224357604051638379a9a360e01b815260040160405180910390fd5b895160208b0151604051637837bae560e01b81523092637837bae59261226f9289908990600401614dc3565b60408051808303816000875af115801561228d573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906122b19190614df0565b50506122cd8a600001518b6020015184848e6101800151613224565b50505050505050505050565b61231c816040516024016122ed9190614e14565b60408051601f198184030181529190526020810180516001600160e01b031663104c13eb60e21b1790526133ff565b50565b8060000361232a5750565b61233261191c565b600061233d8261257a565b9050612369604051806040016040528060098152602001681c1bdc1d5b185d195960ba1b8152506122d9565b61237281613420565b6123c1576123a56040518060400160405280600e81526020016d636f726520756e6865616c74687960901b8152506122d9565b604051630d06c24d60e31b8152600481018390526024016103cc565b60006123cb6118ee565b600c01905060006123db82611912565b905060006123e883611716565b905060005b8281101561251b576000828281518110612409576124096146d5565b6020026020010151905061244860405180604001604052806014815260200173191bda5b99c81cdbdb595d1a1a5b99c81a591adb60621b8152506122d9565b600080612460836124576118ee565b60030190613464565b915091506124936040518060400160405280600e81526020016d1dd95b1b081dd948191a59081a5d60921b8152506122d9565b8180156124ae57506000816020015111806124ae5750805115155b156124fa576124e16040518060400160405280600d81526020016c696e2d636f6d2d504c4554452160981b8152506122d9565b604051630f88e15d60e21b815260040160405180910390fd5b61250487846134ed565b5050505080806125139061495b565b9150506123ed565b5061252584613502565b6125455760405163e761affd60e01b8152600481018690526024016103cc565b61254d61191c565b5050505050565b61256761255f6118ee565b600601612dfd565b61193f6125726118ee565b600901612dfd565b6125826141a8565b61258a61191c565b60006125976101566116f2565b905060005b81518110156127175760006125af6116f2565b60020160008484815181106125c6576125c66146d5565b602002602001015181526020019081526020016000206040518060a00160405290816000820160009054906101000a900460ff16600181111561260b5761260b61420d565b600181111561261c5761261c61420d565b81528154602090910190610100900460ff16600181111561263f5761263f61420d565b60018111156126505761265061420d565b81526001820154602082015260028201546001600160a01b03908116604080840191909152600390930154811660609283015290830151838301519251631da2357f60e11b815260048101939093529293506000921690633b446afe906024016000604051808303816000875af11580156126cf573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526126f7919081019061484b565b90506127028161356c565b5050808061270f9061495b565b91505061259c565b506127286127236118ee565b611ed2565b506040850152602084015282526127486127406118ee565b600301613588565b61010087015260e086015260c085015260a0840152608083015260408201516020830151600091612778916149c5565b90506127a060405180604001604052806005815260200164686572726560d81b8152506122d9565b6127ad83606001516130d1565b82516127b8906130d1565b6127c1816130d1565b82516000036127e1576001836000018181516127dd91906149c5565b9052505b82516127f8906120a5908390600160801b906137d0565b8251158015612805575080155b61283e5782511580156128185750600081115b61283457825161282f908290600160801b906137d0565b612841565b600160801b612841565b60005b60608401526040805180820190915260058152643432b9329960d91b602082015261286b906122d9565b5050919050565b6128a46040518060a0016040528060608152602001606081526020016060815260200160608152602001606081525090565b6128ad8261382d565b80825251806001600160401b038111156128c9576128c96146bf565b6040519080825280602002602001820160405280156128f2578160200160208202803683370190505b506020830152806001600160401b03811115612910576129106146bf565b604051908082528060200260200182016040528015612939578160200160208202803683370190505b506040830152806001600160401b03811115612957576129576146bf565b604051908082528060200260200182016040528015612980578160200160208202803683370190505b506060830152806001600160401b0381111561299e5761299e6146bf565b6040519080825280602002602001820160405280156129c7578160200160208202803683370190505b50608083015260005b8181101561286b576000612a0185856000015184815181106129f4576129f46146d5565b6020026020010151613838565b9050806000015184602001518381518110612a1e57612a1e6146d5565b602002602001018181525050806020015184604001518381518110612a4557612a456146d5565b602002602001018181525050806040015184606001518381518110612a6c57612a6c6146d5565b60209081029190910101528051612a82906138c5565b612a8f82602001516138c5565b612a999190614e62565b84608001518381518110612aaf57612aaf6146d5565b60209081029190910101525080612ac58161495b565b9150506129d0565b612ad78284613933565b612ae18184613996565b505050565b600061176d83836139d7565b600061176d8383613aca565b6000806000606060008089519050806001600160401b03811115612b2457612b246146bf565b604051908082528060200260200182016040528015612b4d578160200160208202803683370190505b5092506001915060005b81811015612ca3576000612b9d8c8381518110612b7657612b766146d5565b60200260200101518a8481518110612b9057612b906146d5565b6020026020010151613b19565b905060008a51600014612bc9578a8381518110612bbc57612bbc6146d5565b6020026020010151612bcc565b60005b9050612bd881836149c5565b868481518110612bea57612bea6146d5565b6020026020010181815250506000612c1a8e8581518110612c0d57612c0d6146d5565b6020026020010151613ba7565b905080600003612c305760009550505050612c91565b808d8581518110612c4357612c436146d5565b6020026020010151612c559190614e82565b612c5f908b6149c5565b9950612c6b8183614e82565b612c75908a6149c5565b9850612c818184614e82565b612c8b90896149c5565b97505050505b80612c9b8161495b565b915050612b57565b5050945094509450945094565b606081600001805480602002602001604051908101604052809291908181526020018280548015612d0057602002820191906000526020600020905b815481526020019060010190808311612cec575b50505050509050919050565b6000611770600160801b612d1e61172a565b60070154612d2c9190614d71565b8390600160801b6137d0565b6000806000612d4561172a565b6006015490506000612d5c82600160801b896137d0565b612d6a90600160801b614d71565b90506000612d89612d7961172a565b600701548490600160801b6137d0565b612d9790600160801b614d71565b9050612da48783836137d0565b9450868511612db35784612db5565b865b9450612dc087612d0c565b612dca90866149c5565b9350858411612dd95783612ddb565b855b9350505050935093915050565b600061176d836001600160a01b038416613aca565b6000612e088261382d565b90506000612e1583613e66565b905060005b81811015612e5857612e4584848381518110612e3857612e386146d5565b6020026020010151613e71565b5080612e508161495b565b915050612e1a565b50505050565b6001600160a01b0381166000908152600183016020526040812054151561176d565b600081831115612ead576040516392849f9f60e01b815260048101849052602481018390526044016103cc565b828203612ebc57506000611770565b612ed3612ece84600160801b856137d0565b613ea4565b9050806001600160801b0316612ee761172a565b600901541115612f0c57612f05612efc61172a565b60090154613ea4565b9050611770565b6000612f188484614d71565b9050612f2261172a565b600b0154811015612f3257600091505b5092915050565b61231c81612f456118ee565b600601612f506118ee565b600901613f0d565b600080612f6484613ba7565b9050611f828184614e99565b606080612f7c8361382d565b8051909250806001600160401b03811115612f9957612f996146bf565b604051908082528060200260200182016040528015612fc2578160200160208202803683370190505b5091506000612fcf6118ee565b600c01905060005b828110156118e657600061300d868381518110612ff657612ff66146d5565b60200260200101518861383890919063ffffffff16565b9050806000015181602001511115613045576000858381518110613033576130336146d5565b602002602001018181525050506130bf565b61307186838151811061305a5761305a6146d5565b602002602001015184612e5e90919063ffffffff16565b61309c5761308281602001516138c5565b815161308d906138c5565b6130979190614e62565b61309f565b60005b8583815181106130b1576130b16146d5565b602002602001018181525050505b806130c98161495b565b915050612fd7565b61231c816040516024016130e791815260200190565b60408051601f198184030181529190526020810180516001600160e01b031663f5b1bba960e01b1790526133ff565b606081516001600160401b03811115613131576131316146bf565b60405190808252806020026020018201604052801561315a578160200160208202803683370190505b50905060005b825181101561321e5782818151811061317b5761317b6146d5565b60200260200101516001600160a01b03166370a08231306040518263ffffffff1660e01b81526004016131ae9190614daf565b602060405180830381865afa1580156131cb573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906131ef9190614cc0565b828281518110613201576132016146d5565b6020908102919091010152806132168161495b565b915050613160565b50919050565b825160005b818110156133f6576000858281518110613245576132456146d5565b60200260200101516001600160a01b03166370a08231306040518263ffffffff1660e01b81526004016132789190614daf565b602060405180830381865afa158015613295573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906132b99190614cc0565b905060008583815181106132cf576132cf6146d5565b602002602001015113156133e3578382815181106132ef576132ef6146d5565b6020026020010151858381518110613309576133096146d5565b602002602001015161331b91906149c5565b811461333a57604051636f6b696960e01b815260040160405180910390fd5b306001600160a01b0316637837bae5898989868151811061335d5761335d6146d5565b6020026020010151898781518110613377576133776146d5565b60200260200101516040518563ffffffff1660e01b815260040161339e9493929190614dc3565b60408051808303816000875af11580156133bc573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906133e09190614df0565b50505b50806133ee8161495b565b915050613229565b50505050505050565b80516a636f6e736f6c652e6c6f67602083016000808483855afa5050505050565b600061342a61172a565b60050154826060015111158061343f57508151155b801561177057508160400151826020015161345a91906149c5565b8251101592915050565b600061348a60405180606001604052806000815260200160008152602001600081525090565b6134948484614051565b6134a157600091506134e6565b50506001600160a01b03811660009081526002808401602090815260409283902083516060810185528154815260018281015493820193909352920154928201929092525b9250929050565b600061176d836001600160a01b0384166139d7565b610100810151805160009190825b818110156135615761352061172a565b60050154838281518110613536576135366146d5565b6020026020010151111561354f57506000949350505050565b806135598161495b565b915050613510565b506001949350505050565b61231c816135786118ee565b6135806118ee565b600301613f0d565b6060806060806060600061359b87612872565b805151909150806001600160401b038111156135b9576135b96146bf565b6040519080825280602002602001820160405280156135e2578160200160208202803683370190505b509250806001600160401b038111156135fd576135fd6146bf565b604051908082528060200260200182016040528015613626578160200160208202803683370190505b50935060005b818110156137b35761366b8360000151828151811061364d5761364d6146d5565b602002602001015184606001518381518110612b9057612b906146d5565b85828151811061367d5761367d6146d5565b6020026020010181815250506000836040015182815181106136a1576136a16146d5565b60200260200101518683815181106136bb576136bb6146d5565b60200260200101516136cd91906149c5565b9050836020015182815181106136e5576136e56146d5565b602002602001015181111561371d57600160801b85838151811061370b5761370b6146d5565b602002602001018181525050506137a1565b8360200151600081518110613734576137346146d5565b602002602001015160001461377e57613779600160801b85602001518481518110613761576137616146d5565b6020026020010151836137d09092919063ffffffff16565b613781565b60005b858381518110613793576137936146d5565b602002602001018181525050505b806137ab8161495b565b91505061362c565b505080516020820151604090920151909891975095509193509150565b60008082116138095760405162461bcd60e51b8152602060048201526005602482015264064697620360dc1b60448201526064016103cc565b82600019048411830215820261381e57600080fd5b50910281810615159190040190565b606061177082611716565b61385c60405180606001604052806000815260200160008152602001600081525090565b6138668383614051565b6138835760405163677510db60e11b815260040160405180910390fd5b506001600160a01b0316600090815260029182016020908152604091829020825160608101845281548152600182015492810192909252909201549082015290565b60006001600160ff1b0382111561392f5760405162461bcd60e51b815260206004820152602860248201527f53616665436173743a2076616c756520646f65736e27742066697420696e2061604482015267371034b73a191a9b60c11b60648201526084016103cc565b5090565b6139578161393f6116f2565b60008581526001919091016020526040902090612ae6565b61397457604051636ec9be1160e01b815260040160405180910390fd5b61397c6116f2565b600091825260030160205260409020805460ff1916905550565b6139a2816111406116f2565b5060a082901c806139b16116f2565b60009384526003016020526040909220805460ff191660ff909316929092179091555050565b60008181526001830160205260408120548015613ac05760006139fb600183614d71565b8554909150600090613a0f90600190614d71565b9050818114613a74576000866000018281548110613a2f57613a2f6146d5565b9060005260206000200154905080876000018481548110613a5257613a526146d5565b6000918252602080832090910192909255918252600188019052604090208390555b8554869080613a8557613a85614ebb565b600190038181906000526020600020016000905590558560010160008681526020019081526020016000206000905560019350505050611770565b6000915050611770565b6000818152600183016020526040812054613b1157508154600181810184556000848152602080822090930184905584548482528286019093526040902091909155611770565b506000611770565b600080613b2461405d565b6001600160a01b0385166000908152600191909101602052604090205415613b7057613b4e61405d565b6001600160a01b03851660009081526001919091016020526040902054613b7d565b613b7861405d565b600201545b9050600160801b6001607f1b613b938386614e82565b613b9d91906149c5565b611f829190614e99565b600080613bb261405d565b600301546001600160a01b031690508015613c9257600080826001600160a01b031663feaf968c6040518163ffffffff1660e01b815260040160a060405180830381865afa158015613c08573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190613c2c9190614eeb565b509194509250508215905080613c545760405162032b3d60e81b815260040160405180910390fd5b6000613c608342614d71565b9050613c6a61405d565b600401548111613c8d5760405163d15f73b560e01b815260040160405180910390fd5b505050505b613c9b83614081565b613ca85750600092915050565b6000613cb261405d565b6001600160a01b0380861660009081526020929092526040808320548151633fabe5a360e21b8152915192169350839163feaf968c9160048082019260a0929091908290030181865afa158015613d0d573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190613d319190614eeb565b50505091505060008113613d585760405163c149905d60e01b815260040160405180910390fd5b846001600160a01b031663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa158015613d96573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190613dba9190614f3b565b613dc590600a61503c565b826001600160a01b031663313ce5676040518163ffffffff1660e01b8152600401602060405180830381865afa158015613e03573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190613e279190614f3b565b613e3290600a61503c565b613e496c0c9f2c9cd04674edea4000000084614e82565b613e539190614e99565b613e5d9190614e99565b95945050505050565b600061177082611912565b6001600160a01b0381166000908152600280840160205260408220828155600181018390550181905561176d83836134ed565b60006001600160801b0382111561392f5760405162461bcd60e51b815260206004820152602760248201527f53616665436173743a2076616c756520646f65736e27742066697420696e20316044820152663238206269747360c81b60648201526084016103cc565b60408301515160808401515160005b8281101561404957600086604001518281518110613f3c57613f3c6146d5565b60200260200101519050600083600014613f735787608001518381518110613f6657613f666146d5565b6020026020010151613f76565b60005b9050613f8182614081565b15613fdf57613fd98289606001518581518110613fa057613fa06146d5565b6020026020010151838b60a001518781518110613fbf57613fbf6146d5565b60200260200101518b6140b390949392919063ffffffff16565b50614034565b6140328289606001518581518110613ff957613ff96146d5565b6020026020010151838b60a001518781518110614018576140186146d5565b60200260200101518a6140b390949392919063ffffffff16565b505b505080806140419061495b565b915050613f1c565b505050505050565b600061176d8383612e5e565b7ff0dc3258714a6f504593f4b60de0c969a838d52375f09c403d8345216b69829d90565b60008061408c61405d565b6001600160a01b039384166000908152602091909152604090205490921690911415919050565b6001600160a01b0384166000908152600286016020526040812060018101805485919084906140e39084906149c5565b90915550508054859082906000906140fc9084906149c5565b925050819055508281600201600082825461411791906149c5565b9091555061412790508787612de8565b979650505050505050565b604051806101a0016040528060006001600160a01b03168152602001600060ff168152602001600081526020016000815260200160008152602001600081526020016000815260200160008152602001600081526020016000815260200160001515815260200160008152602001606081525090565b6040518061012001604052806000815260200160008152602001600081526020016000815260200160608152602001606081526020016060815260200160608152602001606081525090565b60006020828403121561420657600080fd5b5035919050565b634e487b7160e01b600052602160045260246000fd5b6002811061231c57634e487b7160e01b600052602160045260246000fd5b600081518084526020808501945080840160005b8381101561427a5781516001600160a01b031687529582019590820190600101614255565b509495945050505050565b600081518084526020808501945080840160005b8381101561427a57815187529582019590820190600101614299565b60006020808301818452808551808352604092508286019150828160051b87010184880160005b8381101561438c57603f19898403018552815160c081516142fc81614223565b8552818901516001600160a01b0316898601528782015188860182905261432582870182614241565b9150506060808301518683038288015261433f8382614285565b925050506080808301518683038288015261435a8382614285565b9250505060a080830151925085820381870152506143788183614285565b9689019694505050908601906001016142dc565b509098975050505050505050565b6001600160a01b038116811461231c57600080fd5b60008083601f8401126143c157600080fd5b5081356001600160401b038111156143d857600080fd5b6020830191508360208260051b85010111156134e657600080fd5b6000806000806000806080878903121561440c57600080fd5b86359550602087013561441e8161439a565b945060408701356001600160401b038082111561443a57600080fd5b6144468a838b016143af565b9096509450606089013591508082111561445f57600080fd5b5061446c89828a016143af565b979a9699509497509295939492505050565b6020815281516020820152602082015160408201526040820151606082015260608201516080820152600060808301516101208060a08501526144c5610140850183614241565b915060a0850151601f19808685030160c08701526144e38483614285565b935060c08701519150808685030160e08701526145008483614285565b935060e0870151915061010081878603018188015261451f8584614285565b908801518782039092018488015293509050611ec88382614285565b60008060008060006060868803121561455357600080fd5b853561455e8161439a565b945060208601356001600160401b038082111561457a57600080fd5b61458689838a016143af565b9096509450604088013591508082111561459f57600080fd5b506145ac888289016143af565b969995985093965092949392505050565b60ff8116811461231c57600080fd5b6000806000606084860312156145e157600080fd5b8335925060208401356145f3816145bd565b915060408401356001600160801b038116811461460f57600080fd5b809150509250925092565b6000806040838503121561462d57600080fd5b82359150602083013561463f816145bd565b809150509250929050565b6002811061231c57600080fd5b600080600080600060a0868803121561466f57600080fd5b853561467a8161464a565b9450602086013561468a8161464a565b9350604086013561469a8161439a565b92506060860135915060808601356146b1816145bd565b809150509295509295909350565b634e487b7160e01b600052604160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b60405160c081016001600160401b038111828210171561470d5761470d6146bf565b60405290565b604051601f8201601f191681016001600160401b038111828210171561473b5761473b6146bf565b604052919050565b805161095f8161464a565b805161095f8161439a565b60006001600160401b03821115614772576147726146bf565b5060051b60200190565b600082601f83011261478d57600080fd5b815160206147a261479d83614759565b614713565b82815260059290921b840181019181810190868411156147c157600080fd5b8286015b848110156147e55780516147d88161439a565b83529183019183016147c5565b509695505050505050565b600082601f83011261480157600080fd5b8151602061481161479d83614759565b82815260059290921b8401810191818101908684111561483057600080fd5b8286015b848110156147e55780518352918301918301614834565b60006020828403121561485d57600080fd5b81516001600160401b038082111561487457600080fd5b9083019060c0828603121561488857600080fd5b6148906146eb565b61489983614743565b81526148a76020840161474e565b60208201526040830151828111156148be57600080fd5b6148ca8782860161477c565b6040830152506060830151828111156148e257600080fd5b6148ee878286016147f0565b60608301525060808301518281111561490657600080fd5b614912878286016147f0565b60808301525060a08301518281111561492a57600080fd5b614936878286016147f0565b60a08301525095945050505050565b634e487b7160e01b600052601160045260246000fd5b60006001820161496d5761496d614945565b5060010190565b602080825260139082015272115e1958dd5d1a5bdb881a5cc81a185b1d1959606a1b604082015260600190565b6020808252600a90820152695245454e5452414e435960b01b604082015260600190565b8082018082111561177057611770614945565b6000808335601e198436030181126149ef57600080fd5b8301803591506001600160401b03821115614a0957600080fd5b6020019150368190038213156134e657600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b6001600160a01b0384168152604060208201819052600090613e5d9083018486614a1e565b60408152614a866040820184516001600160a01b03169052565b60006020840151614a9c606084018260ff169052565b5060408401516080830152606084015160a0830152608084015160c083015260a084015160e083015260c0840151610100818185015260e086015191506101208281860152818701519250610140915082828601528087015192505061016082818601528187015192506101809150614b188286018415159052565b8601516101a085810191909152908601516101c08501919091529050614b426101e0840182614285565b9150508260208301529392505050565b838152604060208201819052810182905260006001600160fb1b03831115614b7957600080fd5b8260051b8085606085013791909101606001949350505050565b6000610120885460ff8116614ba781614223565b845260081c60ff16614bb881614223565b60208401526001890154604084015260028901546001600160a01b03908116606085015260038a01548116608085015260a0840189905260c08401889052861660e084015280610100840152614c118184018587614a1e565b9998505050505050505050565b60c081526000614c3160c083018a614241565b8281036020840152614c43818a614241565b90508281036040840152614c578189614285565b6001600160a01b03881660608501526080840187905283810360a08501529050614c82818587614a1e565b9a9950505050505050505050565b9384526001600160a01b0392909216602084015260ff1660408301526001600160801b0316606082015260800190565b600060208284031215614cd257600080fd5b5051919050565b600060208284031215614ceb57600080fd5b81516117238161439a565b60006101208851614d0681614223565b83526020890151614d1681614223565b8060208501525060408901516040840152606089015160018060a01b0380821660608601528060808c01511660808601528960a08601528860c086015280881660e0860152505080610100840152614c118184018587614a1e565b8181038181111561177057611770614945565b8481526001600160a01b0384166020820152606060408201819052600090611ec89083018486614a1e565b6001600160a01b0391909116815260200190565b6001600160a01b03948516815260ff93909316602084015292166040820152606081019190915260800190565b60008060408385031215614e0357600080fd5b505080516020909101519092909150565b600060208083528351808285015260005b81811015614e4157858101830151858201604001528201614e25565b506000604082860101526040601f19601f8301168501019250505092915050565b8181036000831280158383131683831282161715612f3257612f32614945565b808202811582820484141761177057611770614945565b600082614eb657634e487b7160e01b600052601260045260246000fd5b500490565b634e487b7160e01b600052603160045260246000fd5b805169ffffffffffffffffffff8116811461095f57600080fd5b600080600080600060a08688031215614f0357600080fd5b614f0c86614ed1565b9450602086015193506040860151925060608601519150614f2f60808701614ed1565b90509295509295909350565b600060208284031215614f4d57600080fd5b8151611723816145bd565b600181815b80851115614f93578160001904821115614f7957614f79614945565b80851615614f8657918102915b93841c9390800290614f5d565b509250929050565b600082614faa57506001611770565b81614fb757506000611770565b8160018114614fcd5760028114614fd757614ff3565b6001915050611770565b60ff841115614fe857614fe8614945565b50506001821b611770565b5060208310610133831016604e8410600b8410161715615016575081810a611770565b6150208383614f58565b806000190482111561503457615034614945565b029392505050565b600061176d60ff841683614f9b56fe7265736f6c7574696f6e207265736f6c7665642e20576520676f7420656d2e20636865636b696e67206865616c74682e2e2ea164736f6c6343000811000a"""

    # Create our contract class.
    PMContract = w3.eth.contract(abi=pm_abi, bytecode=bytecode)
    # issue a transaction to deploy the contract.
    tx_hash = PMContract.constructor().transact(
        {
            "from": deploy_address,
        }
    )
    # wait for the transaction to be mined
    tx_receipt = w3.eth.wait_for_transaction_receipt(tx_hash, 180)
    # instantiate and return an instance of our contract.
    return PMContract(tx_receipt.contractAddress)